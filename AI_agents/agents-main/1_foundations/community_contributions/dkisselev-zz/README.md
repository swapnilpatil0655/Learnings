# Digital Persona - Personal Knowledge Base

A RAG application that creates a queryable digital persona based on Facebook and LinkedIn data exports.

---

## üìÅ Project Structure

```
dkisselev-zz/
‚îú‚îÄ‚îÄ persona_rag/                    # üöÄ Main Application
‚îÇ   ‚îú‚îÄ‚îÄ persona_app.py             # Gradio chat interface
‚îÇ   ‚îú‚îÄ‚îÄ ingest.py                  # Data ingestion + vector DB creation
‚îÇ   ‚îú‚îÄ‚îÄ answer.py                  # RAG retrieval with configurable techniques
‚îÇ   ‚îú‚îÄ‚îÄ evaluate.py                # Evaluation, tuning, RAG comparison
‚îÇ   ‚îú‚îÄ‚îÄ tests.jsonl                # 25 test questions (LLM-generated) (.gitginored)
‚îÇ   ‚îú‚îÄ‚îÄ pyproject.toml             # Dependencies (uv)
‚îÇ   ‚îú‚îÄ‚îÄ README.md                  # üìò Complete documentation
‚îÇ   ‚îî‚îÄ‚îÄ data/
‚îÇ       ‚îú‚îÄ‚îÄ process_data.py        # Data processing (Facebook + LinkedIn)
‚îÇ       ‚îú‚îÄ‚îÄ processed_facebook_data.json  # (.gitignored)
‚îÇ       ‚îú‚îÄ‚îÄ processed_linkedin_data.json  # (.gitignored)
‚îÇ       ‚îî‚îÄ‚îÄ vector_db/             # Chroma database (.gitignored)
‚îú‚îÄ‚îÄ data_raw/
‚îÇ   ‚îú‚îÄ‚îÄ facebook/                  # Raw Facebook export
‚îÇ   ‚îî‚îÄ‚îÄ linkedin/                  # Raw LinkedIn export
‚îî‚îÄ‚îÄ README.md                      # This file
```

---

## üìä Data Overview

Data for Facebook and LinkedIn files is collected through data export functionality of the corresponding services and process usign `process_data.py` to tranform to json file that is locaed to ChromaDB for RAG

### Facebook Data (Personal Life)
- Profile information (name, location, family, education)
- Years of posts and status updates
- Comments and social interactions
- Messages (privacy-preserving: only sent)
- Pages liked
- Events attended
- Group memberships
- Saved content
- Books read and app activities

### LinkedIn Data (Professional Career)
- Professional profile and headline
- Career history
- Technical skills
- Professional certifications
- Education
- Colleague recommendations
- Projects
- Publications and thought leadership


### Test Question Generation

The evaluation framework uses `tests.jsonl` - a collection of 25 test questions generated by an LLM based on your processed data.

**Example test question:**
```json
{
  "question": "What is your current position?",
  "keywords": ["Tensor Lab", "Research Fellow", "current"],
  "reference_answer": "Research Fellow at The Tensor Lab, UCSF",
  "category": "career"
}
```

**Generating tests:**

1. Load your processed data into an LLM (GPT-4)
2. Prompting it to generate diverse test questions based on the content
3. Saving in JSONL format with required fields: `question`, `keywords`, `reference_answer`, `category`

*Note:* Questions could be generated manually as well without LLM participation

---

## üéØ Architecture Highlights

### Data Pipeline
```
Raw Data (Facebook + LinkedIn)
    ‚Üì
Processing (first-person natural language)
    ‚Üì
Grouping (semantic units by category & time)
    ‚Üì
Chunking (1250 chars, 250 overlap)
    ‚Üì
Embeddings (GTE-small, 384 dims)
    ‚Üì
Vector DB (Chroma)
```

### RAG Query Pipeline
```
User Query 
    ‚Üì
(Query Expansion) ‚Üí Sub-queries ‚Üí 
Semantic Search ‚Üí (Hybrid BM25) ‚Üí 
Reranking ‚Üí Context Retrieved
    ‚Üì
LLM with RAG Context
    ‚Üì
Agentic Tool Calls (as needed):
  ‚Ä¢ record_user_details (email capture)
  ‚Ä¢ record_unknown_question (improvement tracking)
  ‚Ä¢ push (Pushover notifications)
    ‚Üì
Final Response
```
---

## üéì Key Features

### Advanced RAG Techniques
- **Query Expansion** - Alternative phrasings for better coverage
- **Hybrid Search** - BM25 keyword + semantic search
- **Sub-query Generation** - Break complex questions into parts
- **Cross-Encoder Reranking** - Precision-focused ranking

### Evaluation & Optimization
- **Hyperparameter Tuning** - Optimized chunk size
- **RAG Comparison** - Test all 4 configurations to find best approach
- **Comprehensive Metrics** - MRR, nDCG, Coverage, Accuracy, Completeness, Relevance
- **LLM-as-Judge** - Answer quality evaluation

### Application Features
- **Gradio Interface** - Clean, interactive chat UI
- **Agentic Architecture** - Uses OpenAI function calling (tools) for intelligent actions
  - `record_user_details` - Captures email addresses and user information
  - `record_unknown_question` - Logs questions that cannot be answered for future improvement
  - `push` - Sends Pushover notifications for important interactions
- **Smart Email Collection** - Collects contact info once via tool calling, doesn't re-ask
- **Conversation History** - Multi-turn context management

---

## üöÄ Quick Start

```bash
# Navigate to application
cd persona_rag

# Install dependencies
uv sync

# Create .env file
echo "OPENAI_API_KEY=sk-proj-..." > .env

# Ingest data (if not already done)
uv run python ingest.py

# Launch application
uv run python persona_app.py
```

**Open browser:** `http://127.0.0.1:7860`

---

## üõ†Ô∏è Development Commands

```bash
# Data Processing
cd persona_rag/data
python process_data.py facebook          # Process Facebook only
python process_data.py linkedin          # Process LinkedIn only
python process_data.py both              # Process both

# Application
cd ..
uv run python persona_app.py             # Launch app

# Evaluation & Optimization
uv run python evaluate.py --compare-rag  # Compare RAG techniques
uv run python evaluate.py --tune         # Hyperparameter tuning
uv run python evaluate.py --eval         # Run evaluation
uv run python evaluate.py --all          # Everything

# RAG Technique Testing
uv run python evaluate.py --eval --query-expansion
uv run python evaluate.py --eval --hybrid-search
```